properties([
    parameters([
        choice (
            choices: ['', 'validate_files', 'docker-build', 'ec2-build', 'pull-ec2-list', 'Run_custom_scipt'],
            description: 'enter the job to run',
            name: 'Job_Type'
        ),
        choice (
            choices: ['','v1','v2', 'v3'],
            description: 'Choose your version',
            name: 'versions'
        )
    ])
])



pipeline {
    agent any

    stages {
        stage('validate') {
            when {
                expression { params.Job_Type == 'validate_files' }
            }
            steps {
                echo 'validating file..'
            }
        }
        stage('docker-build') {
            when {
                expression { params.Job_Type == 'docker-build' }
            }
            steps {
                sh '''

                echo 'building docker from docker file'
                cd sandeep &&
                docker build -t jenkins .
                // below code to push docker to respective registry
                // docker login <registry_url>
                // docker tag registry_url
                // docker push

                '''
            }
        }
        stage('ec2-build') {
            when {
                expression { params.Job_Type == 'ec2-build' }
            }
            steps {
                sh '''
                
                echo 'describing ec2 instance....'
                cd santosh &&
                ls -ltr
                pwd
                sh buildec2.sh

                '''
            }
        }
        stage('get ec2 InstancesId') {
            when {
                expression { params.Job_Type == 'pull-ec2-list' }
            }
            steps {
                sh '''
                ls -ltr
                pwd
                sh jyoti/pullec2instances.sh

                '''
            }
        }
        stage('custom_script') {
            when {
                expression { params.Job_Type == 'Run_custom_scipt' }
            }
            steps {
                sh '''
                echo "*******RUNNING CUSTOM SCRIPT BLK**********"
                chmod 400 giriraj/dev_workstation_2.pem
                ssh -o "StrictHostKeyChecking no" -i giriraj/dev_workstation_2.pem ubuntu@34.201.32.42 'bash -s' < giriraj/config.sh            
                '''
            }
        }
    }
}
